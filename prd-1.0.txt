# Product Requirements Document: TV Guide Plugin

**Version:** 1.0
**Date:** May 31, 2025
**Author/Owner:** [Your Name/Plugin Developer]

## 1. Introduction

This document outlines the requirements for a TV Guide Plugin designed to fetch and display daily television schedules from the KT TV guide website (`https://tv.kt.com/`). The plugin will consist of two main components: a Python script for data acquisition and JSON conversion, and a Liquid template for displaying the fetched data within a plugin environment.

## 2. Goals

*   To provide users with an easy way to view TV program schedules for specific KT channels.
*   To allow users to specify the channel and date for the desired schedule.
*   To present the schedule information in a clear, concise, and user-friendly format within the plugin UI.
*   To create a robust data fetching mechanism that handles the specifics of the target website's API.

## 3. Target Users

*   Users of the plugin environment who wish to quickly check TV schedules.
*   The developer for integrating this functionality.

## 4. User Stories

*   As a user, I want to specify a channel ID to see its TV schedule.
*   As a user, I want to specify a date (or default to today) to see the TV schedule for that day.
*   As a user, I want to see the program's start time, title, and genre.
*   As a user, I want to quickly identify if a program is currently "ON AIR".
*   As a user, I want to see the channel's name and logo for easy identification.

## 5. Functional Requirements

### 5.1. Data Acquisition and Processing (Python Script)

*   **FR1.1: Fetch HTML Data:** The script must fetch schedule data from `https://tv.kt.com/tv/channel/pSchedule.asp`.
*   **FR1.2: HTTP POST Request:** The request must be an HTTP POST.
*   **FR1.3: Request Payload:**
    *   The payload must include:
        *   `ch_type` (e.g., "4")
        *   `service_ch_no` (user-provided channel ID)
        *   `view_type` (e.g., "1" for daily schedule)
    *   If a specific date (other than the current day) is requested, the payload must also include `seldate` (format: YYYYMMDD).
    *   If no specific date is requested (for current day), the `seldate` parameter should be omitted from the payload.
*   **FR1.4: Request Headers:** The script must send appropriate headers, including `User-Agent`, `Content-Type: application/x-www-form-urlencoded; charset=UTF-8`, `Referer`, `X-Requested-With`, and `Origin`.
*   **FR1.5: HTML Parsing:** The script must parse the fetched HTML response (encoded in `euc-kr`) using BeautifulSoup.
*   **FR1.6: Data Extraction:** The script must extract the following information:
    *   Displayed Date
    *   Channel Name
    *   Channel Logo URL
    *   For each program:
        *   Time (HH:MM)
        *   Title
        *   Genre
        *   Icons (list of strings, including `alt` text or `src` fallback)
        *   On-air status (boolean: `true`/`false`)
*   **FR1.7: JSON Output:** The script must convert the extracted data into a structured JSON format. The top-level JSON object should include keys such as `channel_id_requested`, `date_requested`, `date_displayed`, `channel_name`, `channel_logo_url`, and a `programs` array.
*   **FR1.8: User Input:** The script should prompt the user to input the `service_ch_no` (Channel ID) and optionally a date in YYYYMMDD format.
*   **FR1.9: File Output:** The script should save the generated JSON to a local file, with a filename indicating the channel and date. Error logs should also be saved to a file if fetching fails.
*   **FR1.10: Error Handling:** The script should handle potential errors during HTTP requests (e.g., network issues, bad status codes) and parsing, providing informative messages.

### 5.2. Data Display (Liquid Template)

*   **FR2.1: Display Channel Information:** The plugin UI must display:
    *   Channel Logo (`channel_logo_url`)
    *   Channel Name (`channel_name`)
    *   Schedule Date (`date_displayed`)
    *   Optionally, the requested date if different from the displayed date.
*   **FR2.2: Program Listing:** The plugin UI must list TV programs from the `programs` array. Initially, this will be limited to the first 5 programs.
*   **FR2.3: Program Details:** For each listed program, display:
    *   Broadcast Time (`program.time`)
    *   Program Title (`program.title`)
    *   Program Genre (`program.genre`)
*   **FR2.4: On-Air Indicator:** If a program has `is_on_air: true`, an "ON AIR" visual indicator must be displayed next to it.
*   **FR2.5: No Programs Message:** If the `programs` array is empty or unavailable, a message indicating "No program information available" should be displayed.
*   **FR2.6: Plugin Title Bar:** A title bar at the bottom should display the plugin's instance name and optionally the channel logo (smaller).
*   **FR2.7: Data Source:** The template will consume the JSON data generated by the Python script, accessed via variables like `{{ programs }}`, `{{ channel_name }}`, etc.

## 6. Technical Requirements

*   **TR1: Python Script:**
    *   Language: Python 3.x
    *   Libraries: `requests` (for HTTP requests), `BeautifulSoup4` (for HTML parsing), `json` (for JSON handling), `re` (for regex), `datetime`.
*   **TR2: Plugin Display:**
    *   Templating Engine: Liquid.
    *   Assumes a plugin environment that can render Liquid templates and inject the JSON data.
*   **TR3: Data Format:** JSON as specified in FR1.7. Example structure:
    ```json
    {
      "channel_id_requested": "7",
      "date_requested": "20250531", 
      "date_displayed": "2025-05-31",
      "channel_name": "KBS2",
      "channel_logo_url": "https://tv.kt.com/...",
      "programs": [
        {
          "time": "HH:MM",
          "title": "Program Title",
          "genre": "Program Genre",
          "is_on_air": true,
          "icons": ["icon_alt_text_1", "Icon (src: /path/to/icon.png)"]
        }
      ]
    }
    ```

## 7. UI/UX Considerations (Liquid Template)

*   The display should be clean and easy to read.
*   The "ON AIR" status should be prominent.
*   Basic layout will be a single column, with programs listed vertically.
*   Styling will leverage classes potentially provided by the plugin environment (e.g., `layout`, `grid`, `item`, `text--gray-3`, `label--inverted`), supplemented by minimal inline styles for unique elements.

## 8. Release Criteria (MVP - Minimum Viable Product)

*   Python script successfully fetches and parses data for a given channel and date (or current day) and saves it as valid JSON.
*   Liquid template successfully displays the channel information and the first 5 programs with their time, title, genre, and on-air status from the generated JSON.
*   Basic error handling is in place for data fetching.

## 9. Future Considerations / Out of Scope for MVP

*   Displaying all programs, not just the first 5 (e.g., with pagination or scrolling).
*   Mapping icon `src` paths to meaningful descriptions (e.g., "자막방송") instead of just "Icon (src: ...)".
*   More sophisticated UI for selecting channels and dates (e.g., dropdowns, calendar pickers) if the plugin environment allows.
*   Displaying program icons visually.
*   Automatic refresh of schedule data.
*   Timezone handling for program times if the source data is not already localized.
*   More detailed error display within the plugin UI itself.

## 10. Dependencies

*   The plugin's functionality relies on the Python script to provide the necessary JSON data.
*   The Python script relies on external libraries (`requests`, `BeautifulSoup4`).
*   The stability and structure of the `tv.kt.com` website and its `pSchedule.asp` endpoint.

---
_End of Document_